(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-190ce8f8"],{"931d":function(e,t,s){},"98ab":function(e,t,s){"use strict";s("931d")},b3e2:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-container"},[s("div",{staticClass:"setting-container"},[s("i",{staticClass:"el-icon-setting",on:{click:function(t){e.drawer=!0}}})]),s("div",[s("el-drawer",{attrs:{visible:e.drawer,"with-header":!1,size:"460px"},on:{"update:visible":function(t){e.drawer=t}}},[s("a",{staticStyle:{height:"0"},attrs:{href:"/"}}),s("div",{staticClass:"setting-timer"},[s("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"到","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp",align:"left",size:"small"},on:{change:e.refreshChart},model:{value:e.timeRange,callback:function(t){e.timeRange=t},expression:"timeRange"}})],1),s("div",{staticClass:"setting-cluster"},[e._l(e.cluster_charts,(function(t,i){return[s("span",{key:i},[s("el-checkbox",{staticClass:"setting-item",attrs:{label:t.title,border:"",size:"small"},model:{value:t.visible,callback:function(s){e.$set(t,"visible",s)},expression:"chart.visible"}})],1)]}))],2),e._l(e.nodes_metrics,(function(t,i){return[s("div",{key:"i"+i,staticClass:"setting-node"},[e._l(e.nodes_charts[i],(function(t,i){return[s("span",{key:"j"+i},[s("el-checkbox",{staticClass:"setting-item",attrs:{label:t.title,border:"",size:"small"},model:{value:t.visible,callback:function(s){e.$set(t,"visible",s)},expression:"chart.visible"}})],1)]}))],2)]}))],2)],1),s("div",{staticClass:"cluster-container"},[s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 集群状态 ")]),e.cluster_metrics.cluster_status&&0===e.cluster_metrics.cluster_status.value?s("span",{staticClass:"overview-text overview-green"},[e._v(" green ")]):e._e(),e.cluster_metrics.cluster_status&&1===e.cluster_metrics.cluster_status.value?s("span",{staticClass:"overview-text overview-yellow"},[e._v(" yellow ")]):e._e(),e.cluster_metrics.cluster_status&&2===e.cluster_metrics.cluster_status.value?s("span",{staticClass:"overview-text overview-red"},[e._v(" red ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" CPU使用 ")]),e.cluster_metrics.cpu_percent?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.cluster_metrics.cpu_percent.value)+" % ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 内存使用 ")]),e.cluster_metrics.mem_used_bytes?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanBytes(e.cluster_metrics.mem_used_bytes.value))+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 存储使用 ")]),e.cluster_metrics.store_bytes?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanBytes(e.cluster_metrics.store_bytes.value))+" ")]):e._e()])])],1),s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 节点数量 ")]),e.cluster_metrics.nodes_count?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.cluster_metrics.nodes_count.value)+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 索引数量 ")]),e.cluster_metrics.indices_count?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.cluster_metrics.indices_count.value)+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 数据总量 ")]),e.cluster_metrics.docs_count?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanNumber(e.cluster_metrics.docs_count.value))+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 磁盘剩余 ")]),e.cluster_metrics.fs_free_bytes?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanBytes(e.cluster_metrics.fs_free_bytes.value))+" ")]):e._e()])])],1),e._l(e.cluster_charts,(function(t,i){return[s("el-collapse-transition",{key:i},[t.visible?s("el-row",{staticClass:"chart-row",attrs:{gutter:0}},[s("span",{staticClass:"chart-title chart-title-cluster"},[e._v(" "+e._s(t.title)+" ")]),s("span",{staticClass:"chart-close"},[s("i",{staticClass:"el-icon el-icon-close",on:{click:function(e){t.visible=!1}}})]),s("linechart",{attrs:{settings:t}})],1):e._e()],1)]}))],2),e._l(e.nodes_metrics,(function(t,i){return s("div",{key:"i"+i,staticClass:"node-container"},[s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 节点名称 ")]),t.cpu_percent.instance?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(t.cpu_percent.instance)+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" CPU使用 ")]),t.cpu_percent?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(t.cpu_percent.value)+" % ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 内存使用 ")]),t.mem_used_bytes?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanBytes(t.mem_used_bytes.value))+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 存储使用 ")]),t.store_bytes?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanBytes(t.store_bytes.value))+" ")]):e._e()])])],1),s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 节点地址 ")]),t.cpu_percent?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(t.cpu_percent.host)+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 数据总量 ")]),t.docs_count?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanNumber(t.docs_count.value))+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 内存占比 ")]),t.mem_percent?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(t.mem_percent.value)+" % ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 存储剩余 ")]),t.fs_free_bytes?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanBytes(t.fs_free_bytes.value))+" ")]):e._e()])])],1),s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 写入总量 ")]),t.index_total?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanNumber(t.index_total.value))+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 查询总量 ")]),t.query_total?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(e.humanNumber(t.query_total.value))+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 查询阻塞 ")]),t.search_queue?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(t.search_queue.value)+" ")]):e._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[e._v(" 写入阻塞 ")]),t.write_queue?s("span",{staticClass:"overview-text"},[e._v(" "+e._s(t.write_queue.value)+" ")]):e._e()])])],1),e._l(e.nodes_charts[i],(function(t,i){return[s("el-collapse-transition",{key:"j"+i},[t.visible?s("el-row",{staticClass:"chart-row",attrs:{gutter:0}},[s("span",{staticClass:"chart-title chart-title-node"},[e._v(" "+e._s(t.title)+" ")]),s("span",{staticClass:"chart-close"},[s("i",{staticClass:"el-icon el-icon-close",on:{click:function(e){t.visible=!1}}})]),s("linechart",{attrs:{settings:t}})],1):e._e()],1)]}))],2)}))],2)},a=[],r=(s("4de4"),s("b0c0"),s("d3b7"),s("b775"));function c(e){var t="/api/v1/monitor/"+e+"/metric";return Object(r["a"])({url:t,method:"get"})}function o(e,t){var s="/api/v1/monitor/"+e+"/history";return Object(r["a"])({url:s,method:"post",data:t})}var n={metric:c,history:o};s("4160"),s("c975"),s("b680"),s("4d63"),s("ac1f"),s("25f0"),s("4d90"),s("5319"),s("1276"),s("159b"),s("53ca");function l(e){if(Math.abs(e)<1e4)return e+"";var t=1,s=["万","亿","万亿"],i=-1,a=Math.pow(10,t);do{e/=1e4,++i}while(Math.round(Math.abs(e)*a)/a>=1e4&&i<s.length-1);return e.toFixed(t)+" "+s[i]}function v(e){return Math.abs(e)<1e3?e+"毫秒":(e/=1e3,e<60?e.toFixed(1)+"秒":(e/=60,e<60?e.toFixed(1)+"分钟":(e/=60,e<60?e.toFixed(1)+"小时":(e/=24,e.toFixed(1)+"天"))))}function m(e){if(Math.abs(e)<1024)return e+" B";var t=1,s=["kB","MB","GB","TB","PB","EB","ZB","YB"],i=-1,a=Math.pow(10,t);do{e/=1024,++i}while(Math.round(Math.abs(e)*a)/a>=1024&&i<s.length-1);return e.toFixed(t)+" "+s[i]}var u=s("2ef0"),h=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{style:{height:e.height,width:e.width}})},d=[],_=s("313e"),p={props:{width:{type:String,default:"100%"},height:{type:String,default:"250px"},settings:{type:Object,required:!0}},data:function(){return{data:[],chart:null}},watch:{settings:{deep:!0,handler:function(){this.refreshChart()}}},mounted:function(){var e=this;this.$nextTick((function(){e.initChart()}))},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=_["a"](this.$el),this.refreshChart()},refreshChart:function(){var e=this;this.data=[],n.history(this.settings.reqId,this.settings.reqBody).then((function(t){for(var s=t.result.records,i=0,a=s.length;i<a;i++)e.data.push([s[i].time,s[i].value]);e.setOptions()})).catch((function(){}))},setOptions:function(){var e=this,t={grid:{top:"10%",bottom:"20%",left:"10%",rigth:"10%"},tooltip:{trigger:"axis",formatter:function(t){var s=t[0].axisValueLabel,i=t[0].data[1],a=t[0].marker;return"percent"===e.settings.type?s+"<br />"+a+i+"%":"bytes"===e.settings.type?s+"<br />"+a+m(i)+" ("+i+")":"count"===e.settings.type?s+"<br />"+a+l(i)+" ("+i+")":"ms"===e.settings.type?s+"<br />"+a+v(i)+" ("+i+")":s+"<br />"+a+i}},xAxis:{type:"time"},yAxis:{type:"value",scale:!0,axisLabel:{formatter:function(t,s){return"percent"===e.settings.type?t+"%":"bytes"===e.settings.type?m(t):"count"===e.settings.type?l(t):"ms"===e.settings.type?v(t):t}}},series:{name:"value",type:"line",symbol:"circle",data:e.data,lineStyle:{width:1,color:e.settings.color},itemStyle:{color:e.settings.color}}};this.chart.setOption(t)}}},g=p,y=s("2877"),f=Object(y["a"])(g,h,d,!1,null,null,null),w=f.exports,C={name:"Monitor",components:{linechart:w},data:function(){return{id:"",drawer:!1,loading:!1,timeRange:[(new Date).getTime()-36e5,(new Date).getTime()],pickerOptions:{shortcuts:[{text:"最近1小时",onClick:function(e){var t=(new Date).getTime(),s=t-36e5;e.$emit("pick",[s,t])}},{text:"最近6小时",onClick:function(e){var t=(new Date).getTime(),s=t-216e5;e.$emit("pick",[s,t])}},{text:"最近1天",onClick:function(e){var t=(new Date).getTime(),s=t-864e5;e.$emit("pick",[s,t])}},{text:"最近2天",onClick:function(e){var t=(new Date).getTime(),s=t-1728e5;e.$emit("pick",[s,t])}},{text:"最近1周",onClick:function(e){var t=(new Date).getTime(),s=t-6048e5;e.$emit("pick",[s,t])}}]},cluster_metrics:{},cluster_charts:[],nodes_metrics:[],nodes_charts:[]}},created:function(){this.fetchData()},methods:{humanBytes:m,humanNumber:l,fetchData:function(){var e=this.$route.name.substring(8);this.id=e,this.fetchMetric(),this.renderClusterChart(),this.renderNodesChart()},fetchMetric:function(){var e=this;this.loading=!0,n.metric(this.id).then((function(t){var s=Object(u["groupBy"])(t.result,"category"),i={};Object(u["forEach"])(s["cluster"],(function(e){i[e.metric]=e}));var a=Object(u["groupBy"])(s["node"],"instance"),r=[];Object(u["forIn"])(a,(function(e,t){var s={};Object(u["forEach"])(e,(function(e){s[e.metric]=e})),r.push(s)})),e.cluster_metrics=i,e.nodes_metrics=r,e.renderNodesChart()})).catch((function(){})).finally((function(){e.loading=!1}))},refreshChart:function(){if(this.timeRange){for(var e=0,t=this.cluster_charts.length;e<t;e++){var s=this.cluster_charts[e];s.reqBody.filter.timeFrom=this.timeRange[0],s.reqBody.filter.timeTo=this.timeRange[1]}for(var i=0,a=this.nodes_charts.length;i<a;i++)for(var r=this.nodes_charts[i],c=0,o=r.length;c<o;c++){var n=r[c];n.reqBody.filter.timeFrom=this.timeRange[0],n.reqBody.filter.timeTo=this.timeRange[1]}}},renderClusterChart:function(){var e=this.id;this.cluster_charts.push({visible:!0,title:"CPU使用",type:"percent",color:"#409eff",reqId:e,reqBody:{filter:{metric:"cpu_percent",category:"cluster",timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}}),this.cluster_charts.push({visible:!0,title:"内存使用",type:"bytes",color:"#409eff",reqId:e,reqBody:{filter:{metric:"mem_used_bytes",category:"cluster",timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}}),this.cluster_charts.push({visible:!1,title:"存储使用",type:"bytes",color:"#409eff",reqId:e,reqBody:{filter:{metric:"store_bytes",category:"cluster",timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}}),this.cluster_charts.push({visible:!1,title:"磁盘剩余",type:"bytes",color:"#409eff",reqId:e,reqBody:{filter:{metric:"fs_free_bytes",category:"cluster",timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}}),this.cluster_charts.push({visible:!1,title:"数据总量",type:"count",color:"#409eff",reqId:e,reqBody:{filter:{metric:"docs_count",category:"cluster",timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}})},renderNodesChart:function(){for(var e=this.id,t=this.nodes_metrics,s=0,i=t.length;s<i;s++){var a=t[s],r=a.cpu_percent.instance;this.renderNodeChart(e,r)}},renderNodeChart:function(e,t){var s=[{visible:!0,title:t+" / CPU使用",type:"percent",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"cpu_percent",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!0,title:t+" / 内存占比",type:"percent",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"mem_percent",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 内存使用",type:"bytes",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"mem_used_bytes",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / fielddata缓存",type:"bytes",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"fielddata_bytes",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 查询缓存",type:"bytes",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"query_cache_bytes",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 请求缓存",type:"bytes",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"request_cache_bytes",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 存储使用",type:"bytes",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"store_bytes",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 磁盘剩余",type:"bytes",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"fs_free_bytes",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 数据总量",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"docs_count",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / YoungGC次数",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"young_gc_count",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / YoungGC耗时",type:"ms",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"young_gc_ms",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / OldGC次数",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"old_gc_count",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / OldGC耗时",type:"ms",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"old_gc_ms",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 写入总量",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"index_total",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 查询总量",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"query_total",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 查询阻塞",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"search_queue",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}},{visible:!1,title:t+" / 写入阻塞",type:"count",color:"#67c23a",reqId:e,reqBody:{filter:{metric:"write_queue",category:"node",instance:t,timeFrom:this.timeRange[0],timeTo:this.timeRange[1]}}}];this.nodes_charts.push(s)}}},b=C,q=(s("98ab"),Object(y["a"])(b,i,a,!1,null,"ccc114e8",null));t["default"]=q.exports}}]);