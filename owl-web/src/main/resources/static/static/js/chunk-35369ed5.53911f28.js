(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35369ed5"],{"6c2f":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"app-container"},[s("div",{staticClass:"setting-container"},[s("i",{staticClass:"el-icon-setting",on:{click:function(e){t.drawer=!0}}})]),s("div",[s("el-drawer",{attrs:{visible:t.drawer,"with-header":!1,size:"460px"},on:{"update:visible":function(e){t.drawer=e}}},[s("a",{staticStyle:{height:"0"},attrs:{href:"/"}}),s("div",{staticClass:"setting-timer"},[s("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"到","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp",align:"left",size:"small"},on:{change:t.refreshChart},model:{value:t.timeRange,callback:function(e){t.timeRange=e},expression:"timeRange"}})],1),s("div",{staticClass:"setting-cluster"},[t._l(t.cluster_charts,(function(e,a){return[s("span",{key:a},[s("el-checkbox",{staticClass:"setting-item",attrs:{label:e.title,border:"",size:"small"},model:{value:e.visible,callback:function(s){t.$set(e,"visible",s)},expression:"chart.visible"}})],1)]}))],2),t._l(t.nodes_metrics,(function(e,a){return[s("div",{key:"i"+a,staticClass:"setting-node"},[t._l(t.nodes_charts[a],(function(e,a){return[s("span",{key:"j"+a},[s("el-checkbox",{staticClass:"setting-item",attrs:{label:e.title,border:"",size:"small"},model:{value:e.visible,callback:function(s){t.$set(e,"visible",s)},expression:"chart.visible"}})],1)]}))],2)]}))],2)],1),s("div",{staticClass:"cluster-container"},[s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 集群状态 ")]),t.cluster_metrics.cluster_status&&0===t.cluster_metrics.cluster_status.value?s("span",{staticClass:"overview-text overview-green"},[t._v(" green ")]):t._e(),t.cluster_metrics.cluster_status&&1===t.cluster_metrics.cluster_status.value?s("span",{staticClass:"overview-text overview-yellow"},[t._v(" yellow ")]):t._e(),t.cluster_metrics.cluster_status&&2===t.cluster_metrics.cluster_status.value?s("span",{staticClass:"overview-text overview-red"},[t._v(" red ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" CPU使用 ")]),t.cluster_metrics.cpu_percent?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(t.cluster_metrics.cpu_percent.value,"percent"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 内存使用 ")]),t.cluster_metrics.heap_used_percent?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(t.cluster_metrics.heap_used_percent.value,"percent"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 存储使用 ")]),t.cluster_metrics.store_bytes?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(t.cluster_metrics.store_bytes.value,"bytes"))+" ")]):t._e()])])],1),s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 节点数量 ")]),t.cluster_metrics.nodes_count?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.cluster_metrics.nodes_count.value)+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 索引数量 ")]),t.cluster_metrics.indices_count?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(t.cluster_metrics.indices_count.value,"count"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 数据总量 ")]),t.cluster_metrics.docs_count?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(t.cluster_metrics.docs_count.value,"count"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 磁盘剩余 ")]),t.cluster_metrics.fs_free_bytes?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(t.cluster_metrics.fs_free_bytes.value,"bytes"))+" ")]):t._e()])])],1),t._l(t.cluster_charts,(function(e,a){return[s("el-collapse-transition",{key:a},[e.visible?s("el-row",{staticClass:"chart-row",attrs:{gutter:0}},[s("span",{staticClass:"chart-title chart-title-cluster"},[t._v(" "+t._s(e.title)+" ")]),s("span",{staticClass:"chart-close"},[s("i",{staticClass:"el-icon el-icon-close",on:{click:function(t){e.visible=!1}}})]),s("linechart",{attrs:{settings:e}})],1):t._e()],1)]}))],2),t._l(t.nodes_metrics,(function(e,a){return s("div",{key:"i"+a,staticClass:"node-container"},[s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 节点名称 ")]),e.cpu_percent.instance?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(e.cpu_percent.instance)+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" CPU使用 ")]),e.cpu_percent?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(e.cpu_percent.value,"percent"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 内存使用 ")]),e.heap_used_percent?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(e.heap_used_percent.value,"percent"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 存储使用 ")]),e.store_bytes?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(e.store_bytes.value,"bytes"))+" ")]):t._e()])])],1),s("el-row",{staticClass:"overview-row",attrs:{gutter:0}},[s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 节点地址 ")]),e.cpu_percent?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(e.cpu_percent.host)+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" cpu负载 ")]),e.index_total?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(e.cpu_load.value)+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 数据总量 ")]),e.docs_count?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(e.docs_count.value,"count"))+" ")]):t._e()])]),s("el-col",{staticClass:"overview-col",attrs:{span:6}},[s("div",{staticClass:"overview-item"},[s("span",{staticClass:"overview-name"},[t._v(" 存储剩余 ")]),e.fs_free_bytes?s("span",{staticClass:"overview-text"},[t._v(" "+t._s(t.humanReadable(e.fs_free_bytes.value,"bytes"))+" ")]):t._e()])])],1),t._l(t.nodes_charts[a],(function(e,a){return[s("el-collapse-transition",{key:"j"+a},[e.visible?s("el-row",{staticClass:"chart-row",attrs:{gutter:0}},[s("span",{staticClass:"chart-title chart-title-node"},[t._v(" "+t._s(e.title)+" ")]),s("span",{staticClass:"chart-close"},[s("i",{staticClass:"el-icon el-icon-close",on:{click:function(t){e.visible=!1}}})]),s("linechart",{attrs:{settings:e}})],1):t._e()],1)]}))],2)}))],2)},i=[],r=(s("4de4"),s("b0c0"),s("d3b7"),s("2ef0")),c=s("7cf8"),n=s("ed08"),l=s("eff9"),o={name:"Monitor",components:{linechart:l["a"]},data:function(){return{id:"",drawer:!1,loading:!1,timeRange:[(new Date).getTime()-36e5,(new Date).getTime()],pickerOptions:{shortcuts:[{text:"最近1小时",onClick:function(t){var e=(new Date).getTime(),s=e-36e5;t.$emit("pick",[s,e])}},{text:"最近6小时",onClick:function(t){var e=(new Date).getTime(),s=e-216e5;t.$emit("pick",[s,e])}},{text:"最近1天",onClick:function(t){var e=(new Date).getTime(),s=e-864e5;t.$emit("pick",[s,e])}},{text:"最近2天",onClick:function(t){var e=(new Date).getTime(),s=e-1728e5;t.$emit("pick",[s,e])}},{text:"最近1周",onClick:function(t){var e=(new Date).getTime(),s=e-6048e5;t.$emit("pick",[s,e])}}]},cluster_metrics:{},cluster_charts:[],nodes_metrics:[],nodes_charts:[]}},created:function(){this.fetchData()},methods:{humanReadable:n["a"],fetchData:function(){var t=this.$route.name.substring(8);this.id=t,this.fetchMetric()},fetchMetric:function(){var t=this;this.loading=!0,c["a"].metric(this.id).then((function(e){var s=Object(r["groupBy"])(e.result,"category"),a={};Object(r["forEach"])(s["cluster"],(function(t){a[t.metric]=t}));var i=Object(r["groupBy"])(s["node"],"instance"),c=[];Object(r["forIn"])(i,(function(t,e){var s={};Object(r["forEach"])(t,(function(t){s[t.metric]=t})),c.push(s)})),t.cluster_metrics=a,t.nodes_metrics=c,t.renderClusterChart(),t.renderNodesChart()})).catch((function(){})).finally((function(){t.loading=!1}))},refreshChart:function(){if(this.timeRange){for(var t=0,e=this.cluster_charts.length;t<e;t++){var s=this.cluster_charts[t];s.reqBody.filter.timeFrom=this.timeRange[0],s.reqBody.filter.timeTo=this.timeRange[1]}for(var a=0,i=this.nodes_charts.length;a<i;a++)for(var r=this.nodes_charts[a],c=0,n=r.length;c<n;c++){var l=r[c];l.reqBody.filter.timeFrom=this.timeRange[0],l.reqBody.filter.timeTo=this.timeRange[1]}}},renderClusterChart:function(){var t=this,e=this.id,s=this.timeRange,a=this.cluster_metrics;Object(r["forIn"])(a,(function(a,i){var r="cpu_percent"===a.metric||"heap_used_percent"===a.metric;t.cluster_charts.push({visible:r,instance:a.instance,alias:a.alias,title:a.instance+"/"+a.alias,unit:a.unit,color:"#409eff",reqId:e,reqBody:{filter:{metric:a.metric,category:a.category,timeFrom:s[0],timeTo:s[1]}}})}))},renderNodesChart:function(){var t=this,e=this.id,s=this.timeRange,a=this.nodes_metrics;Object(r["forEach"])(a,(function(a){var i=[];Object(r["forIn"])(a,(function(t,a){var r="cpu_percent"===t.metric||"heap_used_percent"===t.metric;i.push({visible:r,instance:t.instance,alias:t.alias,title:t.instance+"/"+t.alias,unit:t.unit,color:"#67c23a",reqId:e,reqBody:{filter:{metric:t.metric,category:t.category,instance:t.instance,timeFrom:s[0],timeTo:s[1]}}})})),t.nodes_charts.push(i)}))}}},v=o,u=(s("97a4"),s("2877")),h=Object(u["a"])(v,a,i,!1,null,"81d20c20",null);e["default"]=h.exports},"7cf8":function(t,e,s){"use strict";var a=s("b775");function i(t){var e="/api/v1/monitor/"+t+"/metric";return Object(a["a"])({url:e,method:"get"})}function r(t,e){var s="/api/v1/monitor/"+t+"/history";return Object(a["a"])({url:s,method:"post",data:e})}e["a"]={metric:i,history:r}},"97a4":function(t,e,s){"use strict";s("e023")},e023:function(t,e,s){},ed08:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));s("4160"),s("c975"),s("b680"),s("d3b7"),s("4d63"),s("ac1f"),s("25f0"),s("4d90"),s("5319"),s("1276"),s("159b"),s("53ca");function a(t,e){return"percent"===e?t+"%":"count"===e?i(t):"ms"===e?r(t):"bytes"===e?c(t):"kilobytes"===e?n(t):t}function i(t){if(Math.abs(t)<1e4)return t+"";var e=1,s=["万","亿","万亿"],a=-1,i=Math.pow(10,e);do{t/=1e4,++a}while(Math.round(Math.abs(t)*i)/i>=1e4&&a<s.length-1);return t.toFixed(e)+" "+s[a]}function r(t){return Math.abs(t)<1e3?t+"毫秒":(t/=1e3,t<60?t.toFixed(1)+"秒":(t/=60,t<60?t.toFixed(1)+"分钟":(t/=60,t<60?t.toFixed(1)+"小时":(t/=24,t.toFixed(1)+"天"))))}function c(t){if(Math.abs(t)<1024)return t+" B";var e=1,s=["kB","MB","GB","TB","PB","EB","ZB","YB"],a=-1,i=Math.pow(10,e);do{t/=1024,++a}while(Math.round(Math.abs(t)*i)/i>=1024&&a<s.length-1);return t.toFixed(e)+" "+s[a]}function n(t){if(Math.abs(t)<1024)return t+" kB";var e=1,s=["MB","GB","TB","PB","EB","ZB","YB"],a=-1,i=Math.pow(10,e);do{t/=1024,++a}while(Math.round(Math.abs(t)*i)/i>=1024&&a<s.length-1);return t.toFixed(e)+" "+s[a]}},eff9:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{style:{height:t.height,width:t.width}})},i=[],r=s("313e"),c=s("7cf8"),n=s("ed08"),l={props:{width:{type:String,default:"100%"},height:{type:String,default:"250px"},settings:{type:Object,required:!0}},data:function(){return{data:[],chart:null}},watch:{settings:{deep:!0,handler:function(){this.refreshChart()}}},mounted:function(){var t=this;this.$nextTick((function(){t.initChart()}))},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=r["a"](this.$el),this.refreshChart()},refreshChart:function(){var t=this;this.data=[],c["a"].history(this.settings.reqId,this.settings.reqBody).then((function(e){for(var s=e.result,a=0,i=s.length;a<i;a++)t.data.push([s[a].time,s[a].value]);t.setOptions()})).catch((function(){}))},setOptions:function(){var t=this,e={grid:{top:"10%",bottom:"20%",left:"10%",rigth:"10%"},tooltip:{trigger:"axis",formatter:function(e){var s=e[0].axisValueLabel,a=e[0].data[1],i=e[0].marker,r=Object(n["a"])(a,t.settings.unit);return r===a?s+"<br />"+i+a:"percent"===t.settings.unit?s+"<br />"+i+r:s+"<br />"+i+r+" ("+a+")"}},xAxis:{type:"time"},yAxis:{type:"value",scale:!0,axisLabel:{formatter:function(e,s){return Object(n["a"])(e,t.settings.unit)}}},series:{name:"value",type:"line",symbol:"circle",data:t.data,lineStyle:{width:1,color:t.settings.color},itemStyle:{color:t.settings.color}}};this.chart.setOption(e)}}},o=l,v=s("2877"),u=Object(v["a"])(o,a,i,!1,null,null,null);e["a"]=u.exports}}]);